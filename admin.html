<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin | Lucky Draw</title>
  <link rel="stylesheet" href="style.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@400;600&display=swap"
    rel="stylesheet"
  />
</head>
<body>
  <div class="container">
    <h1 class="glow-pink">Admin: Lucky Draw</h1>
    <div id="loginBox">
      <input type="text" id="adminId" placeholder="Admin ID" />
      <input type="password" id="adminPass" placeholder="Password" />
      <button class="glow-blue" onclick="adminLogin()">Login</button>
      <div id="adminLoginMsg"></div>
    </div>
    <div id="adminPanel" class="hide">
      <button class="glow-pink" onclick="spinWinner()">ğŸ° Spin Winner</button>
      <button class="glow-blue" onclick="resetLeads()" style="margin-left:0.7em;">ğŸ—‘ï¸ Reset Leads</button>
      <div id="spinMsg"></div>
      <div id="resetMsg"></div>
      <h3>Leads</h3>
      <table id="leadsTbl">
        <tr>
          <th>Name</th>
          <th>Phone</th>
          <th>Date</th>
        </tr>
      </table>
    </div>
  </div>
  <script>
    function adminLogin() {
      fetch("/api/admin/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          adminid: document.getElementById("adminId").value,
          password: document.getElementById("adminPass").value,
        }),
      }).then((r) => {
        if (r.ok) {
          document.getElementById("loginBox").classList.add("hide");
          document.getElementById("adminPanel").classList.remove("hide");
          loadLeads();
        } else {
          document.getElementById("adminLoginMsg").textContent =
            "Wrong ID or Password!";
        }
      });
    }
    function loadLeads() {
      fetch("/api/admin/leads")
        .then((r) => r.json())
        .then((rows) => {
          let tbl = document.getElementById("leadsTbl");
          tbl.innerHTML =
            "<tr><th>Name</th><th>Phone</th><th>Date</th></tr>" +
            rows
              .map(
                (x) =>
                  `<tr><td>${x.name}</td><td>${x.phone}</td><td>${x.date}</td></tr>`
              )
              .join("");
        });
    }
    function spinWinner() {
      fetch("/api/admin/spin", { method: "POST" })
        .then((r) => r.json())
        .then((win) => {
          document.getElementById("spinMsg").innerHTML = win.error
            ? win.error
            : `<div class="winner-card winner-anim"><span>ğŸ†</span><br/><b>${win.name}</b><br/>${win.phone}</div>`;
        });
    }
    function resetLeads() {
      if (!confirm("Are you sure you want to delete all leads?")) return;
      fetch("/api/admin/reset-leads", { method: "POST" })
        .then((r) => r.json())
        .then((resp) => {
          document.getElementById("resetMsg").innerHTML = resp.success
            ? "<div class='pop-success'>All leads deleted!</div>"
            : "<div class='pop-fail'>Error deleting leads!</div>";
          loadLeads();
        });
    }
  </script>
</body>
</html>
